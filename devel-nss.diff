# HG changeset patch
# Parent bff449eaa6b0059dbd6c6ac1231e5ab85537efb6

diff -r bff449eaa6b0 devel/nss/Makefile
--- a/devel/nss/Makefile	Mon Feb 18 12:24:19 2013 -0500
+++ b/devel/nss/Makefile	Mon Feb 18 12:24:23 2013 -0500
@@ -66,6 +66,17 @@
 	find ${WRKSRC} -type f | xargs ${CHMOD} 644
 	find ${WRKSRC} -type d | xargs ${CHMOD} 755
 
+# [Gregor] And just where is this type SUPPOSED to come from?
+_WRAP_EXTRA_ARGS.CC+=-Duint=uint32_t
+
+# [Gregor] This build loses, but needs, our CFLAGS
+_WRAP_EXTRA_ARGS.CC+=-D_GNU_SOURCE -D_BSD_SOURCE
+
+# [Gregor] More misdetection
+pre-build:
+	${SED} 's/DHAVE_SYS_CDEFS_H/UHAVE_SYS_CDEFS_H/' -i ${WRKSRC}/security/dbm/config/config.mk
+	${SED} 's/(ffs/(__builtin_ffs/g' -i ${WRKSRC}/security/nss/cmd/checkcert/checkcert.c
+
 do-build:
 	cd ${WRKSRC}/security/nss && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} \
 	  build_coreconf build_dbm all
