# HG changeset patch
# Parent 5810dbb24a44c4ede2b05e457e16766bd8b2b591

diff -r 5810dbb24a44 devel/nspr/Makefile
--- a/devel/nspr/Makefile	Mon Feb 18 12:24:14 2013 -0500
+++ b/devel/nspr/Makefile	Mon Feb 18 12:24:18 2013 -0500
@@ -78,6 +78,13 @@
 BUILDLINK_PASSTHRU_DIRS+=	Developer/Headers/FlatCarbon
 .endif
 
+# [Gregor] SOL_TCP is deprecated
+CFLAGS+=-DSOL_TCP=IPPROTO_TCP
+
+# [Gregor] the detection is broken
+pre-build:
+	${SED} 's/#define _PR_HAVE_GETPROTO_R.*//' -i ${WRKSRC}/nsprpub/pr/src/misc/prnetdb.c
+
 pre-configure:
 	cd ${WRKSRC}/nsprpub && autoconf
 
