# HG changeset patch
# Parent ce03d6687212650848de24124f9568079c96a10b

diff -r ce03d6687212 devel/nspr/Makefile
--- a/devel/nspr/Makefile	Tue Oct 09 17:52:46 2012 -0400
+++ b/devel/nspr/Makefile	Tue Oct 09 17:52:52 2012 -0400
@@ -73,6 +73,13 @@
 BUILDLINK_PASSTHRU_DIRS+=	Developer/Headers/FlatCarbon
 .endif
 
+# [Gregor] SOL_TCP is deprecated
+CFLAGS+=-DSOL_TCP=IPPROTO_TCP
+
+# [Gregor] the detection is broken
+pre-build:
+	${SED} 's/#define _PR_HAVE_GETPROTO_R.*//' -i ${WRKSRC}/nsprpub/pr/src/misc/prnetdb.c
+
 pre-configure:
 	cd ${WRKSRC}/nsprpub && autoconf
 
